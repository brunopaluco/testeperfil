(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{"4WO5":function(e,s,i){"use strict";var t=i("D57K"),r=(i("68Mn"),i("dV61"),i("nsO7")),o=i("lut3"),a=i("0JpG"),n=i("fYJU"),l=i("12mu"),d=i("pjml"),h=i("gbHk"),u=i("emI2"),c=i("lEL+"),p=i("Q/M7"),m=i("tkGi");function w(e){let s=e;return/^\+?\d+$/.test(e)||(s=e.replace(/[^\+\d]/g,"")),s}var b=i("jhBu"),f=i("zGdY"),P=i("Zjmk"),g=i("IbyE"),v=i("50Q+"),y=i("c+ks"),O=i("aHpC");i.d(s,"c",(function(){return $})),i.d(s,"b",(function(){return j})),i.d(s,"a",(function(){return M}));const $="ultra.base.profile.controller",j=o.a;let S=class{constructor(e,s,i,t,r,o,a,n,l,d,u,c,p,w,b,f,P,g){this.$window=e,this.$document=s,this.$http=i,this.$timeout=t,this.$scope=r,this.userConfiguration=o,this.isMobileDistributorActive=a,this.$ngRedux=n,this.contextUser=l,this.UserModel=d,this.modal=u,this.prefService=c,this.timeout=p,this.LanguagesModel=w,this.bbLocalize=b,this.NotificationGeneralSettings=f,this.PrivacyPolicyModel=P,r.baseProfile=this,this.subscribeToReduxChanges(),this.loadOtherNameAsDisplayNameSystemPreference({key:v.g}),g.hasAnySystemEntitlements(["self.locale.MODIFY","system.user.properties.MODIFY"]).then((e=>{this.canModifyLocale=e})),g.hasAnySystemEntitlements(["self.privacy.MODIFY","system.user.properties.MODIFY"]).then((e=>{this.canModifyPrivacySetting=e})),this.UserModel.$find("me").$asPromise().then((e=>{this.loadCurrentUser(e)})),f.$build().$fetch().$then((e=>{r.isSmsOn="A"===e.settings.sms_setting.attributeValue})),this.$scope.$on(j,((e,s)=>{this.loadCurrentUser(s),l._setUserModel(s)})),this.$scope.$on(h.b,(e=>{this.msgModal=this.showChangePasswordSuccessMessage(),this.closeChangePasswordSuccessMessage(this.msgModal,2e3)})),this.$scope.$on(m.a,((e,s)=>{this.setUpLanguages(s)})),this.PrivacyPolicyModel.getPrivacyPolicy().then((e=>{this.privacyPolicy=e}))}canEditFullName(){var e,s,i,t,r,o,a;return!!(null===(s=null===(e=this.user)||void 0===e?void 0:e.permissions)||void 0===s?void 0:s.fieldPermissions.givenName)||!!(null===(t=null===(i=this.user)||void 0===i?void 0:i.permissions)||void 0===t?void 0:t.fieldPermissions.familyName)||!!(null===(o=null===(r=this.user)||void 0===r?void 0:r.permissions)||void 0===o?void 0:o.fieldPermissions.otherName)||"Y"===(null===(a=this.otherNameAsDisplayNameSystemPreference)||void 0===a?void 0:a.value)}showChangePasswordSuccessMessage(){return this.modal.open({scope:this.$scope,template:y,resolve:{translations:[a.serviceName,e=>e.loadBundle("features/base/profile/base-profile")]}})}closeChangePasswordSuccessMessage(e,s){e&&this.timeout((()=>{e.dismiss()}),this.$scope,s)}hasPermissionToAddPronouns(){var e,s;return!!(null===(s=null===(e=this.user)||void 0===e?void 0:e.permissions)||void 0===s?void 0:s.fieldPermissions.pronouns)}userHasPronouns(){var e;return!!(null===(e=this.user)||void 0===e?void 0:e.pronouns)}pronounAriaLabel(){return this.userHasPronouns()?"base.profile.pronouns.edit":"base.profile.pronouns.add"}userPronouns(){return Object(P.c)(this.user)}genderAriaLabel(){switch(this.user.gender){case f.I.Male:return"base.profile.gender.edit.male";case f.I.Female:return"base.profile.gender.edit.female";case f.I.Other:return"base.profile.gender.edit.other";default:return"base.profile.gender.add"}}loadCurrentUser(e){this.user=e,this.LanguagesModel.$collection().$fetch({limit:1e4}).$then((e=>{this.languages=e,this.setUpLanguages(this.user.locale)})),this.user.permissions.fieldPermissions||(this.user.permissions.fieldPermissions={},r.values(this.userConfiguration).forEach((e=>{r.set(this.user.permissions.fieldPermissions,e.fieldName,this.user.permissions.editAccountInfo&&e.isEditable)}))),this.user.mobilePhone&&(this.user.mobilePhone=w(this.user.mobilePhone)),this.user.homePhone1&&(this.user.homePhone1=w(this.user.homePhone1)),this.user.businessPhone1&&(this.user.businessPhone1=w(this.user.businessPhone1))}pronunciationAriaLabel(){var e;return(null===(e=this.user)||void 0===e?void 0:e.pronunciation)?"base.profile.pronunciation.edit":"base.profile.pronunciation.add"}userHasPhoneNumber(){return this.user&&(this.user.businessPhone1||this.user.homePhone1||this.user.mobilePhone)}userCanEditPhoneNumber(){return this.user&&this.user.permissions.fieldPermissions&&(this.user.permissions.fieldPermissions.businessPhone1||this.user.permissions.fieldPermissions.homePhone1||this.user.permissions.fieldPermissions.mobilePhone)}userHasMailingAddress(){return this.user&&(this.user.street1||this.user.street2||this.user.city||this.user.state||this.user.zipCode||this.user.country)}userCanEditMailingAddress(){return this.user&&this.user.permissions.fieldPermissions&&(this.user.permissions.fieldPermissions.street1||this.user.permissions.fieldPermissions.street2||this.user.permissions.fieldPermissions.city||this.user.permissions.fieldPermissions.state||this.user.permissions.fieldPermissions.zipCode||this.user.permissions.fieldPermissions.country)}showAdditionalInformation(){return this.user&&this.user.permissions.fieldPermissions&&(this.user.permissions.fieldPermissions.gender||this.user.gender&&this.user.gender!==f.I.Unknown||this.user.permissions.fieldPermissions.otherName||this.user.otherName||this.user.permissions.fieldPermissions.birthDate||this.user.birthDate||this.user.permissions.fieldPermissions.educationLevel||this.user.educationLevel&&this.user.educationLevel!==f.E.Unknown||this.user.permissions.fieldPermissions.webPage||this.user.webPage)}showContactInformation(){return this.user&&this.user.permissions.fieldPermissions&&(this.userCanEditMailingAddress()||this.userHasMailingAddress()||this.userHasPhoneNumber()||this.userCanEditPhoneNumber()||this.user.permissions.fieldPermissions.businessFax||this.user.businessFax)}showJobInformation(){return this.user&&this.user.permissions.fieldPermissions&&(this.user.permissions.fieldPermissions.company||this.user.company||this.user.permissions.fieldPermissions.jobTitle||this.user.jobTitle||this.user.permissions.fieldPermissions.department||this.user.department)}openUserWebPage(){p.o(this.user.webPage)}setUpLanguages(e){this.userLanguage=r.find(this.languages,(s=>s.locale===e)),this.systemDefaultLanguage=r.find(this.languages,"isDefault"),this.translatedSystemDefaultLanguageLabel=this.bbLocalize.translateSync({key:"base.profile.language.systemDefault",params:{systemDefaultLanguage:this.systemDefaultLanguage.name},noEscape:!0,noWrap:!0,locale:this.systemDefaultLanguage.locale})}getUserPrivacyAriaKey(){const e=this.contextUser.userModel.visibilityScope.toString().toLowerCase();return`base.profile.privacySettings.edit.${this.contextUser.userModel.isInstructor()?"instructors":"others"}.${e}`}subscribeToReduxChanges(){const e=this.$ngRedux.connect((e=>({otherNameAsDisplayNameSystemPreference:g.Yb.systemPreference.getSystemPreferenceByKey(e,v.g)})),(e=>({loadOtherNameAsDisplayNameSystemPreference:s=>e(g.V.systemPreference.loadSystemPreference(s))})))(this);this.$scope.$on("$destroy",e)}};S=Object(t.a)([Object(t.c)(0,Object(O.b)("$window")),Object(t.c)(1,Object(O.b)("$document")),Object(t.c)(2,Object(O.b)("$http")),Object(t.c)(3,Object(O.b)("$timeout")),Object(t.c)(4,Object(O.b)("$scope")),Object(t.c)(5,Object(O.b)("userConfiguration")),Object(t.c)(6,Object(O.b)("isMobileDistributorActive")),Object(t.c)(7,Object(O.b)("$ngRedux")),Object(t.c)(8,Object(O.b)(n.b)),Object(t.c)(9,Object(O.b)(d.Jb.serviceName)),Object(t.c)(10,Object(O.b)(l.b)),Object(t.c)(11,Object(O.b)(u.c)),Object(t.c)(12,Object(O.b)(c.b)),Object(t.c)(13,Object(O.b)(d.J.serviceName)),Object(t.c)(14,Object(O.b)(a.serviceName)),Object(t.c)(15,Object(O.b)(d.P.serviceName)),Object(t.c)(16,Object(O.b)(d.jb.serviceName)),Object(t.c)(17,Object(O.b)(b.b))],S);class M extends S{}},"68Mn":function(e,s,i){var t=i("ziER"),r=i("5JeM"),o=new t({id:"icon-small-stop-action",use:"icon-small-stop-action-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-stop-action"><path fill="none" stroke-miterlimit="10" d="M7.955.456c-4.142 0-7.5 3.358-7.5 7.5s3.358 7.5 7.5 7.5 7.5-3.358 7.5-7.5-3.357-7.5-7.5-7.5h0z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M5.673 5.673h4.565v4.565H5.673z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M6.325 6.325h3.261v3.261H6.325z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M6.162 6.162h3.587v3.587H6.162z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M6.977 6.977h1.957v1.957H6.977z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M6.814 6.814h2.283v2.283H6.814z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M7.629 7.629h.652v.652h-.652z" /><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M7.466 7.466h.978v.978h-.978z" /></symbol>'});r.add(o);e.exports=o},GkCm:function(e,s,i){var t=i("ziER"),r=i("5JeM"),o=new t({id:"icon-small-main-menu",use:"icon-small-main-menu-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-main-menu"><path d="M1 3h14M15 8H1M1 13h14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});r.add(o);e.exports=o},KXuk:function(e,s,i){var t=i("ziER"),r=i("5JeM"),o=new t({id:"icon-small-complete",use:"icon-small-complete-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-complete"><rect x="1" y="1" width="14" height="14" rx="7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M5 8l2 3 4-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});r.add(o);e.exports=o},"c+ks":function(e,s){e.exports='<bb-modal class="notification change-password"\n          modal-title-key="base.profile.update-password.successModal.title"\n          analytics-id-tag-prefix="base.profile.update.password.closeSuccessModal">\n  <div name="modal-contents">\n    <p bb-translate>base.profile.update-password.successModal.description</p>\n  </div>\n  \x3c!-- htmlhint:analytics-id:disable --\x3e\n  <button name="modal-footer-button-primary"\n          class="button"\n          ng-click="$parent.$close()"\n          bb-translate\n          analytics-id="features.base.profile.update.password.closeSuccessModal.button">global.ok</button>\n  \x3c!-- htmlhint:analytics-id:enable --\x3e\n</bb-modal>'},dV61:function(e,s,i){var t=i("ziER"),r=i("5JeM"),o=new t({id:"icon-small-trash",use:"icon-small-trash-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-trash"><path d="M4 4l2-3h4l2 3M2 5l1 10h10l1-10M1 4h14M8 7v5M11 7l-.5 5M5 7l.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});r.add(o);e.exports=o},gbHk:function(e,s,i){"use strict";i.d(s,"c",(function(){return n})),i.d(s,"b",(function(){return l})),i.d(s,"a",(function(){return h}));i("GkCm"),i("6BRP"),i("KXuk");var t=i("fYJU"),r=i("pjml"),o=i("TnpK"),a=i("IbyE");const n="profile.update-password.controller",l="password-changed";class d{constructor(e,s,i,t,r,o,a){this.$rootScope=e,this.$scope=s,this.$modal=i,this.$q=t,this.UserModel=r,this.ultraStateService=o,this.contextUser=a,this.userHasOldPassword=!0,this.isSaving=!1,this.oldPwdIsValid=!1,this.newPwdIsValid=!1,this.newConfirmedPwdIsValid=!1,this.passwordCriteriaMet={lowercaseRequired:!1,uppercaseRequired:!1,passwordLength:!1,specialCharsRequired:!1,numericRequired:!1},this.verifyPasswordMet=!1,this.passwordRulesPresent=!1,this.cancelClicked=()=>{this.ultraStateService.leavePeekState(this.ultraStateService.current.name)},s.updatePassword=this,this.loadCurrentUser(),this.loadPasswordRules()}loadCurrentUser(){this.UserModel.$find(this.contextUser.userId).$asPromise().then((e=>{this.user=e}))}loadPasswordRules(e){this.$q.when(Object(a.Ab)()).then((s=>{this.passwordRules=Object.assign({passwordLength:12},s),this.passwordRulesPresent=!0,e&&this.validatePasswordRules()})).catch((()=>{this.passwordRulesPresent=!1}))}persist(){if(this.isSaving)return this.$q.when();let e;this.isSaving=!0;const s=this.getTrimmedNewPassword();return s&&(this.oldPassword&&(this.user.inputOldPassword=this.oldPassword),this.user.password=s,e=this.user.$patch().$asPromise().then((e=>{this.ultraStateService.leavePeekState(this.ultraStateService.current.name).then((()=>{this.$rootScope.$broadcast(l)}))})).catch((e=>{this.$scope.updatePasswordForm.$setPristine(),400===e.$response.status&&e.$response.data&&e.$response.data.code===d.RESPONSE_ERROR_OLD_PWD?(this.setValidity("old-password",d.INVALID_OLD_PASSWORD,!1),e.$response.status=null):400===e.$response.status&&e.$response.data&&e.$response.data.code===d.RESPONSE_ERROR_NEW_PWD&&(this.setValidity("new-password",d.INVALID_NEW_PASSWORD,!1),this.loadPasswordRules(!0),e.$response.status=null)})).finally((()=>{this.isSaving=!1}))),e||this.$q.when()}getTrimmedNewPassword(){return this.newPassword?this.newPassword.trim():""}setValidity(e,s,i){const t=this.$scope.updatePasswordForm[e];t&&s&&t.$setValidity(s,i)}validate(e){const s=this.getTrimmedNewPassword();this.oldPwdIsValid=!this.userHasOldPassword||!!this.oldPassword,this.newPwdIsValid=!!s,this.newConfirmedPwdIsValid=this.newPassword===this.confirmNewPassword,this.verifyPasswordMet=void 0!==this.newPassword&&void 0!==this.confirmNewPassword&&this.newConfirmedPwdIsValid,e||(this.setValidity("old-password","required",!!this.oldPassword),this.setValidity("new-password","required",!!this.newPassword),this.setValidity("new-password","cannotBeWhiteSpace",!!s),this.setValidity("new-password","invalidNewPassword",!!this.verifyIfRulesDefinedAreMet()),this.setValidity("confirm-new-password","required",!!this.confirmNewPassword),this.setValidity("confirm-new-password","differentWithNewPassword",this.newConfirmedPwdIsValid))}clearValidationForOldPwd(){this.setValidity("old-password","required",!0);const e=this.$scope.updatePasswordForm["old-password"];e&&!e.$valid&&e.$setValidity(d.INVALID_OLD_PASSWORD,!0)}clearValidationForNewPwd(){this.setValidity("new-password","required",!0),this.setValidity("new-password","cannotBeWhiteSpace",!0),this.setValidity("new-password","invalidNewPassword",!0);const e=this.$scope.updatePasswordForm["new-password"];e&&!e.$valid&&this.setValidity("new-password","invalidNewPassword",!1)}clearValidationForConfirmedNewPwd(){this.setValidity("confirm-new-password","required",!0),this.setValidity("confirm-new-password","differentWithNewPassword",!0),this.verifyPasswordMet=void 0!==this.newPassword&&void 0!==this.confirmNewPassword&&this.newPassword===this.confirmNewPassword}isPasswordAllValid(){return this.oldPwdIsValid&&this.newPwdIsValid&&this.newConfirmedPwdIsValid&&this.verifyIfRulesDefinedAreMet()}validatePasswordRules(){if(this.passwordRulesPresent){const e=this.getTrimmedNewPassword(),s=this.passwordRules.passwordLength,i=this.passwordRules.lowercaseRequired,t=this.passwordRules.uppercaseRequired,r=this.passwordRules.numericRequired,o=this.passwordRules.specialCharsRequired;s>0&&(this.passwordCriteriaMet.passwordLength=e.length>=s),i&&(this.passwordCriteriaMet.lowercaseRequired=/\p{Lowercase_Letter}/u.test(e)),t&&(this.passwordCriteriaMet.uppercaseRequired=/\p{Uppercase_Letter}/u.test(e)),r&&(this.passwordCriteriaMet.numericRequired=/[0-9]/.test(e)),o&&(this.passwordCriteriaMet.specialCharsRequired=/[~!@#$%\^&*_\-+=`|(){}\[\]:;\\"\\'<>,.\?/]/g.test(e))}}verifyIfRulesDefinedAreMet(){let e=!0;if(this.passwordRulesPresent){const s=Object.keys(this.passwordRules).filter((e=>this.passwordRules[e]));e=Object.values(s).every((e=>!0===this.passwordCriteriaMet[e]))}return e}validateAndVerifyRules(e){this.validate(e),this.validatePasswordRules()}}d.INVALID_OLD_PASSWORD="invalidOldPassword",d.INVALID_NEW_PASSWORD="invalidNewPassword",d.RESPONSE_ERROR_OLD_PWD="bb-blackboard-core-invalid-old-password",d.RESPONSE_ERROR_NEW_PWD="bb-blackboard-core-invalid-new-password",d.$inject=["$rootScope","$scope","$modal","$q",r.Jb.serviceName,o.d,t.b];class h extends d{}},tkGi:function(e,s,i){"use strict";i.d(s,"c",(function(){return c})),i.d(s,"a",(function(){return p})),i.d(s,"b",(function(){return m}));var t=i("D57K"),r=(i("GkCm"),i("nsO7")),o=i("nmzr"),a=i("0JpG"),n=i("TnpK"),l=i("m2oH"),d=i("pjml"),h=i("fYJU"),u=i("aHpC");const c="ultra.features.base.profile.update.userLanguage.controller",p="language-changed";let m=class{constructor(e,s,i,t,o,a,n,l){this.$scope=e,this.$rootScope=s,this.$http=i,this.$window=t,this.contextUser=o,this.bbLocalize=a,this.LanguagesModel=n,this.ultraState=l,this.isSaving=!1,e.userLanguage=this,this.user=o.userModel,this.originalUserLocale=this.user.locale,n.$collection().$fetch({limit:1e4}).$then((e=>{this.languages=r.filter(e,"isUserEnabled"),this.systemDefaultLanguage=r.find(e,"isDefault"),this.systemDefaultLanguageOptionName=this.bbLocalize.translateSync({key:"base.profile.language.systemDefault",params:{systemDefaultLanguage:this.systemDefaultLanguage.name},noEscape:!0,noWrap:!0,locale:this.user.locale}),r.some(this.languages,(e=>e.locale===this.user.locale))||(this.user.locale=null)}))}setLocation(e){this.$window.location.href=e}reloadUltra(){const e=new URL(this.ultraState.href(o.D.PROFILE_BASE));e.searchParams.append("noCache","true"),this.setLocation(e.href)}persist(){return this.isSaving=!0,""===this.user.locale&&(this.user.locale=null),this.user.$patch().$asPromise().then((()=>{var e;if(this.bbLocalize.isRTL()!==Object(l.a)(null!==(e=this.user.locale)&&void 0!==e?e:this.bbLocalize.defaultLocale))return void this.reloadUltra();this.isSaving=!1,this.bbLocalize.setUserLocale(this.user.locale);const s=this.user.locale||this.bbLocalize.getAppLocale();this.bbLocalize.setLocale(this.$rootScope,s).then((()=>{this.$rootScope.$broadcast(p,s),this.ultraState.go(o.D.PROFILE_BASE)}))})).then((()=>this.user))}validate(){return!0}cancelClicked(){this.user.locale=this.originalUserLocale,this.persist(),this.ultraState.go(o.D.PROFILE_BASE)}};m=Object(t.a)([Object(t.c)(0,Object(u.b)("$scope")),Object(t.c)(1,Object(u.b)("$rootScope")),Object(t.c)(2,Object(u.b)("$http")),Object(t.c)(3,Object(u.b)("$window")),Object(t.c)(4,Object(u.b)(h.b)),Object(t.c)(5,Object(u.b)(a.serviceName)),Object(t.c)(6,Object(u.b)(d.J.serviceName)),Object(t.c)(7,Object(u.b)(n.d))],m)}}]);