(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{"0OB5":function(a,e,s){"use strict";s.r(e);var t=s("Llzl"),i=(s("GkCm"),s("yC9S")),n=s("43zP"),r=s("4WO5"),c=s("fYJU"),l=s("pjml"),o=s("TnpK"),d=s("zGdY");const u="ultra.features.base.profile.privacy.controller";class v{constructor(a,e,s,t){this.$scope=a,this.contextUser=e,this.ultraState=s,this.UserModel=t,this.autoSaveState=n.a.NoChanges,this.privacySettingsInitialState=d.dc.Nobody,this.userBlocks=[],this.visibilityScopes=d.dc,this.isSaving=!1,this.confirmClose=!1,this.persist=()=>this._persist(),this.validate=()=>!0,this.cancelClicked=()=>{this.confirmClose=!0,this.cancel(),this.ultraState.go("base.profile")},this.saveClicked=()=>{this.confirmClose=!0,this._persist().finally((()=>{this.ultraState.go("base.profile")}))},a.privacy=this,this.user=e.userModel,this.user.blocks.$refresh().$asPromise().then((a=>{this.UserModel.findMany(a.map((a=>a.blockedUserId))).$then((a=>{a.forEach((a=>this.userBlocks.push(a)))}))})),i.b.OnRootScope(this.$scope,"usercard.unblock",((a,e)=>{this.userBlocks=this.userBlocks.filter((a=>a.id!==e.$pk))})),this.privacySettingsInitialState=this.user.visibilityScope,this.registerStateChangeListener()}registerStateChangeListener(){this.$scope.$on("$stateChangeStart",((a,e)=>{e.name.indexOf("update")<0&&!this.confirmClose&&this.user.$getChangedKeys().length>0&&(a.preventDefault(),this.$scope.$broadcast("show-confirmation","user-privacy-settings"))}))}_persist(){const a=this.user.visibilityScope&&this.user.visibilityScope!==d.dc.Nobody;return this.user.showWorkInfo=a,this.user.showAddressInfo=a,this.user.showEmailInfo=a,this.user.showAddContactInfo=a,this.isSaving=!0,this.user.$patch().$asPromise().then((a=>(this.$scope.$emit(r.b,a),this.isSaving=!1,this.user)))}cancel(){return this.user.visibilityScope=this.privacySettingsInitialState,this.user.$patch().$asPromise()}}v.$inject=["$scope",c.b,o.d,l.Jb.serviceName];var p=s("Sgjf"),b=s("OdCm");s.d(e,"moduleName",(function(){return h})),s.d(e,"controllerName",(function(){return g})),s.d(e,"template",(function(){return b}));const h="ultra.features.base.profile.privacy",g=u;t.module(h,[p.a,l.N,o.b]).controller(u,v)},"4J8k":function(a,e,s){"use strict";s.d(e,"a",(function(){return n}));var t=s("zYa8"),i=s("dmkk");const n="ultra.components.directives.bbUiIcon.large.AvatarMultiple";Object(t.a)(i.a,n,"bbUiIconLargeAvatarMultiple")},"9Ss5":function(a,e){a.exports='<div class="element-image avatar no-select" aria-hidden="true"\n     ng-class="[avatarsClasses, {\'alert-outline\': isWarningRender}]"\n     bb-load-bundle="components/directives/avatar" bb-cache-compilation="avatar">\n  <div class="avatar-inner" ng-if="isAvatarRender && (!autoUpdate || !autoUpdate())">\n    <div ng-if="::(!first && !second)" class="first avatar-single">\n      \x3c!-- If no user is set --\x3e\n      <div class="initials">\n        <bb-translate>components.directives.avatar.notAssignedInitials</bb-translate>\n      </div>\n    </div>\n\n    <div ng-if="::(first && first.avatarUrl)" class="first avatar-single image-avatar">\n      <img ng-src="{{::first.avatarUrl}}" bb-image-grayscale="{{::isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n      \x3c!-- If first user is set and has avatar image --\x3e\n    </div>\n\n    <div ng-if="::(first && !first.avatarUrl && first.userInitials)"\n         class="first avatar-single {{::first.avatarBg}}">\n      \x3c!-- If first user is set, but does not have avatar image, but has non-CJK name Will still render default--\x3e\n      <img ng-src="{{::first.avatarUrl}}" bb-image-grayscale="{{::isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n    </div>\n\n    <div ng-if="::(first && !first.avatarUrl && !first.userInitials)"\n         class="first avatar-single avatar-placeholder">\n      \x3c!-- If first user is set, but does not have avatar image and name contains CJK characters --\x3e\n      \x3c!-- Show default avatar image --\x3e\n      <img ng-if="::(!first.isMultiUser)" src="./static/images/avatar-placeholder.svg" bb-image-grayscale="{{::isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n      <div class="multi-user-id" ng-if="::(first.isMultiUser)">\n        <bb-ui-icon-large-users></bb-ui-icon-large-users>\n      </div>\n    </div>\n\n    <div ng-if="::(second && second.avatarUrl && participants == 2)" class="second avatar-single image-avatar">\n      <img ng-src="{{second.avatarUrl}}" bb-image-grayscale="{{::isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n      \x3c!-- If second user is set and has avatar image --\x3e\n    </div>\n\n    <div ng-if="::(second && !second.avatarUrl && participants == 2 && second.userInitials)"\n         class="second avatar-single {{::second.avatarBg}}">\n      \x3c!-- If second user is set, but does not have avatar image, but has non-CJK name. Will still render default --\x3e\n      <img ng-src="{{second.avatarUrl}}" bb-image-grayscale="{{::isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.secondAvatarImg : null">\n    </div>\n\n    <div ng-if="::(second && !second.avatarUrl && participants == 2 && !second.userInitials)"\n         class="second avatar-single avatar-placeholder">\n      \x3c!-- If second user is set, but does not have avatar image and name contains CJK characters --\x3e\n      \x3c!-- Show default avatar image --\x3e\n      <img ng-if="::(!second.isMultiUser)" src="./static/images/avatar-placeholder.svg" bb-image-grayscale="{{::isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.secondAvatarImg : null">\n      <div class="multi-user-id" ng-if="::(second.isMultiUser)">\n        <bb-ui-icon-large-avatar-multiple></bb-ui-icon-large-avatar-multiple>\n      </div>\n    </div>\n\n    <div ng-if="participants > 2" class="second avatar-single">\n      \x3c!-- If more than 2 participants involved, show `+3` type of avatar for right side --\x3e\n      \x3c!-- htmlhint:analytics-id:disable --\x3e\n      <div class="initials" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.twoPlusAvatar">\n        <bb-translate translate-values=\'{num: participants - 1}\' aria-hidden="true">components.directives.avatar.twoPlusInitials</bb-translate>\n      </div>\n      \x3c!-- htmlhint:analytics-id:enable --\x3e\n    </div>\n  </div>\n\n  <div class="avatar-inner" ng-if="isAvatarRender && autoUpdate && autoUpdate()">\n\n    <div ng-if="!first && !second" class="first avatar-single">\n      \x3c!-- If no user is set --\x3e\n      \x3c!-- htmlhint:analytics-id:disable --\x3e\n      <div class="initials" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n        <bb-translate>components.directives.avatar.notAssignedInitials</bb-translate>\n      </div>\n      \x3c!-- htmlhint:analytics-id:enable --\x3e\n    </div>\n\n    <div ng-if="first && first.avatarUrl" class="first avatar-single image-avatar">\n      <img ng-src="{{first.avatarUrl}}" bb-image-grayscale="{{isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n      \x3c!-- If first user is set and has avatar image --\x3e\n    </div>\n\n    <div ng-if="first && !first.avatarUrl && first.userInitials"\n         class="first avatar-single {{first.avatarBg}}">\n      \x3c!-- If first user is set, but does not have avatar image, but has non-CJK name --\x3e\n      \x3c!-- Show default image --\x3e\n      <img src="./static/images/avatar-placeholder.svg" bb-image-grayscale="{{isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n    </div>\n\n    <div ng-if="first && !first.avatarUrl && !first.userInitials"\n         class="first avatar-single avatar-placeholder">\n      \x3c!-- If first user is set, but does not have avatar image and name contains CJK characters --\x3e\n      \x3c!-- Show default avatar image --\x3e\n      <img ng-if="::(!first.isMultiUser)" src="./static/images/avatar-placeholder.svg" bb-image-grayscale="{{isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.firstAvatarImg : null">\n      <div class="multi-user-id" ng-if="::(first.isMultiUser)">\n        <bb-ui-icon-large-avatar-multiple></bb-ui-icon-large-avatar-multiple>\n      </div>\n    </div>\n\n    <div ng-if="second && second.avatarUrl && participants == 2" class="second avatar-single image-avatar">\n      <img ng-src="{{second.avatarUrl}}" bb-image-grayscale="{{isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.secondAvatarImg : null">\n      \x3c!-- If second user is set and has avatar image --\x3e\n    </div>\n\n    <div ng-if="second && !second.avatarUrl && participants == 2 && second.userInitials"\n         class="second avatar-single {{second.avatarBg}}">\n      \x3c!-- If second user is set, but does not have avatar image, but has non-CJK name --\x3e\n      \x3c!-- Show default image --\x3e\n      <img src="./static/images/avatar-placeholder.svg" bb-image-grayscale="{{isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.secondAvatarImg : null">\n    </div>\n\n    <div ng-if="second && !second.avatarUrl && participants == 2 && !second.userInitials"\n         class="second avatar-single avatar-placeholder">\n      \x3c!-- If second user is set, but does not have avatar image and name contains CJK characters --\x3e\n      \x3c!-- Show default avatar image --\x3e\n      <img ng-if="::(!second.isMultiUser)" src="./static/images/avatar-placeholder.svg"  bb-image-grayscale="{{isGray()}}" alt="" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.secondAvatarImg : null">\n      <div class="multi-user-id" ng-if="::(second.isMultiUser)">\n        <bb-ui-icon-large-avatar-multiple></bb-ui-icon-large-avatar-multiple>\n      </div>\n    </div>\n\n    <div ng-if="participants > 2" class="second avatar-single">\n      \x3c!-- If more than 2 participants involved, show `+3` type of avatar for right side --\x3e\n      \x3c!-- htmlhint:analytics-id:disable --\x3e\n      <div class="initials" analytics-id="analyticsIdTagPrefix ? {{::analyticsIdTagPrefix}}.twoPlusAvatar : null">\n        <bb-translate translate-values=\'{num: participants - 1}\' aria-hidden="true">components.directives.avatar.twoPlusInitials</bb-translate>\n      </div>\n      \x3c!-- htmlhint:analytics-id:enable --\x3e\n    </div>\n  </div>\n</div>\n'},NMEb:function(a,e,s){"use strict";var t=s("Llzl");var i=class{static convertToGrayscale(a){const e=document.createElement("canvas"),s=e.getContext("2d"),t=a.naturalWidth,i=a.naturalHeight;e.width=t,e.height=i,s.drawImage(a,0,0);const n=s.getImageData(0,0,t,i);let r;const c=n.data.length;for(let a=0;a<c;a+=4)r=(n.data[a]+n.data[a+1]+n.data[a+2])/3,n.data[a]=r,n.data[a+1]=r,n.data[a+2]=r;return s.putImageData(n,0,0,0,0,n.width,n.height),e.toDataURL()}};s.d(e,"a",(function(){return n}));const n="ultra.components.directives.imageGrayscale";class r{constructor(a,e,s){this.scope=a,this.element=e,this.attributes=s;"true"===this.attributes.bbImageGrayscale&&l()&&e.one("load",this.onLoadCallback())}onLoadCallback(){return()=>{const a=i.convertToGrayscale(this.element[0]);this.element[0].src=a}}}class c{constructor(){this.restrict="A",this.link=(a,e,s)=>new r(a,e,s)}}function l(){const a=document.documentMode;return 10===a||11===a}const o=t.module(n,[]);l()&&o.directive("bbImageGrayscale",["$injector",a=>a.instantiate(c)])},OdCm:function(a,e){a.exports='<div id="profile-privacy" class="side-panel">\n  <form bb-autosave save-func="privacy.persist()" validation-func="privacy.validate()" class="basic-profile-form">\n    <div class="panel-wrap privacy-settings has-footer" bb-foundation="">\n      <header class="panel-header simple-header">\n        <div class="panel-titles-container">\n          <span class="panel-sub-title" bb-translate>base.profile.peekPanelSubtitle</span>\n          <div class="black-header-contents">\n            <button class="left-off-canvas-toggle menu-toggle standard-button dark-background"\n                    type="button"\n                    analytics-id="features.base.profile.privacy.menu.button">\n              <bb-svg-icon size="small" icon="main-menu"></bb-svg-icon>\n              <span class="sr-only" bb-translate>base.profile.menu</span>\n            </button>\n            <h1 class="panel-title" bb-translate>base.profile.updatePrivacySettings.pageTitle</h1>\n          </div>\n        </div>\n      </header>\n      <fieldset class="fieldset-privacy">\n        <div class="panel-content panel-content-inner">\n          <div class="panel-info">\n            <legend class="legend-privacy"><span bb-translate>base.profile.updatePrivacySettings.instructions</span></legend>\n          </div>\n          <div>\n            <div class="panel-options">\n              <input type="radio" name="privacySettings" id="privacy-hidden"\n                     ng-model="privacy.user.visibilityScope" ng-value="privacy.visibilityScopes.Nobody"\n                     analytics-id="features.base.profile.privacy.visibility.nobody.input.radio"/>\n              <label ng-if="privacy.user.isInstructor()" for="privacy-hidden" bb-translate>base.profile.updatePrivacySettings.instructors.noOne</label>\n              <label ng-if="!privacy.user.isInstructor()" for="privacy-hidden" bb-translate>base.profile.updatePrivacySettings.others.noOne</label>\n            </div>\n\n            <div class="panel-options">\n              <input type="radio" name="privacySettings" id="privacy-classmates" ng-init="checked=true;"\n                     ng-model="privacy.user.visibilityScope" ng-value="privacy.visibilityScopes.Classmates"\n                     analytics-id="features.base.profile.privacy.visibility.classmates.input.radio"/>\n              <label class="js-instructor-privacy-course-visible" ng-if="privacy.user.isInstructor()" for="privacy-classmates" bb-translate>base.profile.updatePrivacySettings.instructors.myClassmates</label>\n              <label class="js-non-instructor-privacy-course-visible" ng-if="!privacy.user.isInstructor()" for="privacy-classmates" bb-translate>base.profile.updatePrivacySettings.others.myClassmates</label>\n            </div>\n            <div class="panel-options">\n              <input type="radio" name="privacySettings" id="privacy-school"\n                     ng-model="privacy.user.visibilityScope" ng-value="privacy.visibilityScopes.Everyone"\n                     analytics-id="features.base.profile.privacy.visibility.school.input.radio"/>\n              <label ng-if="privacy.user.isInstructor()" for="privacy-school" bb-translate>base.profile.updatePrivacySettings.instructors.mySchool</label>\n              <label ng-if="!privacy.user.isInstructor()" for="privacy-school" bb-translate>base.profile.updatePrivacySettings.others.mySchool</label>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n    </div>\n    <div class="spinner bb-secondary-color-2" ng-if="privacy.isSaving"></div>\n    <bb-save-buttons validate-save="privacy.validate()"\n                     save-action="privacy.saveClicked()"\n                     cancel-action="privacy.cancelClicked()"\n                     can-delete="false"\n                     display-delete-after-saving="true"\n                     analytics-id-tag-prefix="features.base.profile.privacy">\n    </bb-save-buttons>\n  </form>\n  <div class="hide"\n       bb-confirmation-needed="x-bb-close-without-saving"\n       modal-name="user-privacy-settings"\n       show-type="always"\n       ng-click="privacy.cancelClicked()"\n       analytics-id="features.base.profile.privacy.visibility.cancelChanges">\n  </div>\n</div>\n'},SSV0:function(a,e,s){var t=s("ziER"),i=s("5JeM"),n=new t({id:"icon-small-accommodation",use:"icon-small-accommodation-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-accommodation"><circle cx="8" cy="8" r="7" stroke-width="2" /><path d="M4 6l1 2 5-3M12 10l-1-2-5 3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);a.exports=n},Sgjf:function(a,e,s){"use strict";var t=s("D57K"),i=(s("ptBS"),s("SSV0"),s("71td")),n=s("Llzl"),r=s("jciN"),c=s("0JpG"),l=s("fYJU"),o=s("pjml"),d=s("+4Px"),u=s("OvxF"),v=s("lUN/"),p=s("TnpK"),b=s("qeC2"),h=s("aHpC"),g=s("nmzr");s.d(e,"a",(function(){return m}));const m="ultra.components.directives.usercard";class f{constructor(a,e,s,t,i,n,r,c,l,o){this.$modal=a,this.$q=e,this.scope=s,this.element=t,this.attrs=i,this.bbLocalize=n,this.CourseModel=r,this.contextUser=c,this.$userModelService=l,this.ultraState=o,this.current=this.contextUser.userModel,null==this.scope.autoUpdate&&(this.scope.autoUpdate=!0),this.scope.showcard=!1,v.a(),this.$userModelService.$mixHook("after-save",(function(){this.id===s.user.id&&(s.userNames={givenName:this.givenName,familyName:this.familyName})}),s)}canSendMessage(){const a=this.scope.canSendMessage;return!a||a()}hasDueDateException(){const a=this.scope.hasDueDateException;return!!a&&a()}canEditDueDateException(){const a=this.scope.canEditDueDateException;return!!a&&a()}sendMessage(){this.ultraState.goPeekState(this.getMessagePeekState(),{courseId:this.scope.courseId,recipientIds:this.scope.user.id})}getMessagePeekState(){return this.scope.messagePeekState||g.n.COURSE_MESSAGE}getUserNameLabel(){return this.userName=this.scope.userNames,this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.usercard.ariaButtonLabel",params:{user:this.userName},noWrap:!0,noEscape:!0})}keyDown(a){if(a.keyCode===d.t&&a.preventDefault(),this.scope.showcard){let e=!1;if(a.keyCode===d.g)e=!0;else if(a.keyCode===d.u){const s=i(".usercard").find(":tabbable");e=s.length<1||(!(!a.shiftKey||!i(".usercard-clickable").is(":focus"))||(a.shiftKey?document.activeElement===s[0]:document.activeElement===s[s.length-1]))}e&&(a.stopImmediatePropagation(),this.hide())}}hide(){this.scope.showcard&&(this.scope.showcard=!1,this.toggleFloatingContainer(),this.element.find(".usercard-trigger").focus())}show(){this.scope.showcard=!!this.canShow(),this.toggleFloatingContainer()}toggleFloatingContainer(){i(".floating-column-container").css("overflow",this.scope.showcard?"visible":"hidden")}canShow(){return!!this.scope.user&&!!this.scope.user.id&&!this.isSameUser()}isSameUser(){return!(!this.current||!this.scope.user)&&this.scope.user.id===this.current.id}getCourseRoleLocalizeId(){return this.scope.inactive&&this.scope.inactive()?this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.usercard.unavailable"}):this.scope.courseRole()}sendMessageViaSpaceBar(a){this.scope.showcard&&a.keyCode===d.t&&(a.stopPropagation(),this.sendMessage())}}f.$inject=["$modal","$q","scope","element","attrs",c.serviceName,o.m.serviceName,l.b,o.Jb.serviceName,p.d],Object(t.a)([Object(h.d)("locale","userNames")],f.prototype,"getUserNameLabel",null);class y{constructor(a,e,s){this.$injector=a,this.bbLocalize=e,this.ultraState=s,this.restrict="E",this.template=b,this.scope={user:"=",panel:"@?",courseId:"@",messagePeekState:"@?",courseRole:"&",usercardShow:"@",recipientIds:"=",canSendMessage:"&?",hasDueDateException:"&?",canEditDueDateException:"&?",isWarningRender:"=?",membershipId:"=?",inactive:"&?",autoUpdate:"=?"},this.link=(a,e,s)=>{a.attr=s,a.bbUsercard=this.$injector.instantiate(f,{scope:a,element:e,attrs:s}),a.user&&(a.userName=this.bbLocalize.formatUsernameSync(a.user,c.ILocaleUsernameFormat.Short,a,{noWrap:!0,noEscape:!0}),a.userNames=a.user)}}}y.$inject=["$injector",c.serviceName],n.module(m,[r.a,c.moduleName,o.N,l.a,u.a,p.b]).directive("bbUsercard",["$injector",a=>a.instantiate(y)])},jciN:function(a,e,s){"use strict";(function(a){s.d(e,"a",(function(){return b}));var t=s("D57K"),i=(s("SSV0"),s("Llzl")),n=s("PdQf"),r=s("g66W"),c=s("5MwF"),l=s("0JpG"),o=s("NMEb"),d=s("4J8k"),u=s("aHpC"),v=s("9Ss5"),p=s("VdDF");const b="ultra.directives.avatar";class h{constructor(a,e,s,t,i){this.scope=a,this.$element=e,this.attributes=s,this.bbLocalize=t,this.$timeout=i,this.backgroundColors=12;const n=this.scope.$watchGroup(["user.givenName","user.familyName","user.ui.displayName","user.avatar.permanentUrl","user","inactive()","isWarningRender"],(()=>{void 0!==this.scope.user&&(this.renderAvatars(),this.scope.autoUpdate&&this.scope.autoUpdate()||n())})),r=this.scope.$watchCollection("users",(()=>{this.scope.users&&(this.renderAvatars(),this.scope.autoUpdate&&this.scope.autoUpdate()||r())}))}getAvatarBG(a){return"default-avatar-"+(parseInt((a&&a.id||"0").replace(/[^\d]/g,""),10)%this.backgroundColors+1)}avatarParticipantsClass(a){switch(a){case 0:return"no-participants";case 1:return"one-participant";case 2:return"two-participants";default:return"two-plus-participants"}}canDisplayAvatarForUser(a){return!!a&&(!!(a.givenName||a.familyName||this.isAnonymousStudent(a))||!(!a.avatar||!a.avatar.permanentUrl||"default"===a.avatar.permanentUrl))}getInitials(a){return!a||this.isAnonymousStudent(a)||!a.givenName||!a.familyName||Object(r.g)(a.givenName)||Object(r.g)(a.familyName)||Object(r.h)(a.givenName)||Object(r.h)(a.familyName)?null:(a.givenName.charAt(0)+a.familyName.charAt(0)).toLowerCase()}buildAvatarData(a){const e={};if(!this.canDisplayAvatarForUser(a))return null;if(e.avatarBg=this.getAvatarBG(a),e.userInitials=this.getInitials(a),a.ui&&a.ui.displayName?e.username=a.ui.displayName:a.givenName||a.familyName||this.isAnonymousStudent(a)?this.bbLocalize.formatUsername(a,l.ILocaleUsernameFormat.Long,this.scope,{noWrap:!0,noEscape:!0}).then((a=>{e.username=a})):e.username=null,a.avatar&&a.avatar.permanentUrl&&"default"!==a.avatar.permanentUrl){if(/^https?/.test(a.avatar.permanentUrl)&&-1===a.avatar.permanentUrl.indexOf("ts=")){const e=(p.a.isValidDate(a.lastModifiedAt)?a.lastModifiedAt:new Date).getTime();a.avatar.permanentUrl=a.avatar.permanentUrl+(a.avatar.permanentUrl.indexOf("?")>=0?"&ts=":"?ts=")+encodeURIComponent(e)}e.avatarUrl=a.avatar.permanentUrl}return e.isMultiUser=Object(n.k)(a),e}isAnonymousStudent(a){if(a.isAnonymousStudent)return a.isAnonymousStudent()}renderAvatars(){let a=this.scope.users;if(!a&&this.scope.user&&(a=this.scope.user),i.isArray(a)||(a=null!=a?[a]:[]),0===a.length)return this.scope.first=null,this.scope.second=null,this.scope.participants=0,void(this.scope.isAvatarRender=!0);this.scope.participants=a.length,this.scope.avatarsClasses={},i.isDefined(this.scope.inactive)&&(this.scope.avatarsClasses.inactive=this.scope.inactive()),this.scope.avatarsClasses.inactive||(this.scope.avatarsClasses.outline=!0),!this.scope.avatarsClasses.inactive&&i.isDefined(this.scope.customizedActiveStyle)&&(this.scope.avatarsClasses.outline=!0,this.scope.avatarsClasses[this.scope.customizedActiveStyle]=!0),this.scope.avatarsClasses[this.avatarParticipantsClass(a.length)]=!0,this.scope.first=this.buildAvatarData(a[0]),2===a.length?this.scope.second=this.buildAvatarData(a[1]):a.length>2&&(this.scope.second={}),this.scope.isAvatarRender=!0}}let g=class{constructor(a,e){this.bbLocalize=a,this.$timeout=e,this.restrict="E",this.template=v,this.scope={user:"=?",inactive:"&?",users:"=?",autoUpdate:"&?",isGray:"&?",hasException:"&?",customizedActiveStyle:"@?",analyticsIdTagPrefix:"@",isWarningRender:"=?"},this.link=(a,e,s)=>new h(a,e,s,this.bbLocalize,this.$timeout)}};g=Object(t.a)([Object(t.c)(0,Object(u.b)(l.serviceName)),Object(t.c)(1,Object(u.b)("$timeout"))],g),c.a.features.newAvatar?i.module(b,[d.a]).directive("bbAvatar",["$compile",e=>({restrict:"E",scope:!1,priority:Number.MAX_VALUE,terminal:!0,link(s,t,i){const n=Object.prototype.hasOwnProperty.call(i,"users")?"bb-user-avatar-group":"bb-user-avatar",r=a(t[0].outerHTML.replace(/bb\-avatar/g,n));t.replaceWith(r),e(r)(s)}})]):i.module(b,[o.a,d.a]).directive("bbAvatar",["$injector",a=>a.instantiate(g)])}).call(this,s("71td"))},ptBS:function(a,e,s){var t=s("ziER"),i=s("5JeM"),n=new t({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);a.exports=n},qeC2:function(a,e){a.exports='<div bb-load-bundle="components/directives/usercard" bb-cache-compilation="user-card" title="{{::userName}}">\n\n    <div ng-if="user.ui.anonymousStudent" class="anonymous-student-avatar">\n      <bb-avatar user="user" role="presentation" auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n    </div>\n\n    <div ng-if="!user.ui.anonymousStudent"\n         ng-click="bbUsercard.show()"\n         ng-keydown="bbUsercard.keyDown($event)"\n         ng-mouseleave="bbUsercard.hide()"\n         tabindex="{{::bbUsercard.canShow() ? 0 : -1}}"\n         class="usercard-trigger"\n         ng-class="::{\'usercard-clickable\': bbUsercard.canShow(), \'usercard-not-clickable\': !bbUsercard.canShow()}"\n         role="button"\n         aria-expanded="{{showcard}}"\n         analytics-id="components.directives.usercard.showCard"\n    >\n        <div ng-switch="usercardShow" tabindex="-1">\n            <span ng-switch-when="username" class="usercard-button">\n                <bb-username class="name-title" user="user" ng-attr-format="{{attr.format}}" auto-update="{{autoUpdate}}" show-pronouns="true"\n                             ng-class="{ inactive: inactive() }"></bb-username>\n            </span>\n            <span ng-switch-when="avatar" class="usercard-button">\n                <bb-avatar user="user" role="presentation" auto-update="::autoUpdate"\n                  inactive="inactive()" is-warning-render="isWarningRender"></bb-avatar>\n            </span>\n            <span ng-switch-when="combined" class="usercard-button">\n              <bb-avatar user="user" role="presentation" auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n              <bb-username user="user" format="short" auto-update="::autoUpdate" show-pronouns="true" ng-class="{ inactive: inactive() }"></bb-username>\n            </span>\n            <span ng-switch-when="outline" class="usercard-button">\n                <bb-avatar user="user" role="presentation" auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n                <div class="element-details">\n                  <div class="name ellipsis">\n                      <bb-username user="user" format="short" auto-update="::autoUpdate" show-pronouns="true" ng-class="{ inactive: inactive() }"></bb-username>\n                  </div>\n                  <div class="content ellipsis">\n                    <p class="user-name js-course-role" bb-translate>{{bbUsercard.getCourseRoleLocalizeId()}}</p>\n                  </div>\n                </div>\n            </span>\n        </div>\n        <div ng-if="showcard" bb-click-outside="bbUsercard.hide()" is-active="showcard"\n             role="region" aria-label="{{bbUsercard.getUserNameLabel()}}"\n             class="element-card usercard usercard-not-clickable" ng-class="{\'showcard\': showcard }" bb-focus>\n            <div class="header">\n                <bb-avatar user="user" ng-attr-auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n                <div class="element-details">\n                    <div class="name">\n                        <bb-username class="name-title" user="user" ng-class="{ inactive: inactive() }" show-pronouns="true"\n                                     ng-attr-format="{{attr.format}}" ng-attr-auto-update="{{::autoUpdate}}"></bb-username>\n                    </div>\n                  <div class="userId ellipse" ng-if="user.userName && !user.studentId" title="{{user.userName}}">{{user.userName}}</div>\n                  <div class="userId ellipse" ng-if="!user.userName && user.studentId" bb-translate translate-values="{ studentId: user.studentId }">components.directives.usercard.studentId</div>\n                  <div class="userId ellipse" ng-if="user.userName && user.studentId" bb-translate translate-values="{ username: user.userName, studentId: user.studentId }">components.directives.usercard.usernameAndId</div>\n                  <div class="profile ellipsis" bb-translate>{{bbUsercard.getCourseRoleLocalizeId()}}</div>\n                    <div class="profile exception-link" ng-if="bbUsercard.hasDueDateException()">\n                      <div class="clickable ellipsis" ng-if="bbUsercard.canEditDueDateException()" bb-translate bb-peek-sref="accommodation({membershipId: membershipId})">\n                        components.directives.usercard.studentExceptions\n                      </div>\n                      <span ng-if="!bbUsercard.canEditDueDateException()" bb-translate>\n                        components.directives.usercard.studentExceptions\n                      </span>\n                    </div>\n                </div>\n            </div>\n            <div class="buttons">\n              \x3c!-- I don\'t use one time binding, as user can open a peek panel to config this attribute. This configuration has to take effect immediately--\x3e\n              <button aria-hidden="{{!showcard}}" ng-if="bbUsercard.canSendMessage()"\n                      type="button"\n                      ng-click="bbUsercard.sendMessage()"\n                      class="button large clear mail-button"\n                      title="{{user.mail}}"\n                      bb-translate-attrs="{\'aria-label\': \'components.directives.usercard.sendMessage\'}"\n                      tabindex="{{showcard ? 0 : -1}}"\n                      ng-keydown="bbUsercard.sendMessageViaSpaceBar($event)"\n                      analytics-id="components.directives.usercard.sendMessage.button"\n              >\n                <bb-svg-icon size="medium" icon="messages"></bb-svg-icon>\n              </button>\n            </div>\n        </div>\n    </div>\n\n</div>\n'}}]);